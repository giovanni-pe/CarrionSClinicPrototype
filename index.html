<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SaludPlus - Reserva Médica Premium</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            /* Colores actualizados */
            --color-primary: #0066CC;
            --color-primary-light: #4D94FF;
            --color-primary-dark: #004499;
            --color-secondary: #00D4AA;
            --color-accent: #FF6B6B;
            --color-success: #00C851;
            --color-warning: #FFB000;
            --color-error: #FF3547;
            --color-dark: #2C3E50;
            --color-light: #F8FAFC;
            --color-white: #FFFFFF;
            --color-gray-100: #F1F5F9;
            --color-gray-200: #E2E8F0;
            --color-gray-300: #CBD5E1;
            --color-gray-400: #94A3B8;
            --color-gray-500: #64748B;
            --color-gray-600: #475569;
            --color-gray-700: #334155;
            --color-gray-800: #1E293B;
            --color-gray-900: #0F172A;

            /* Yape colors */
            --color-yape: #7B2CBF;
            --color-yape-light: #9747D6;
            --color-yape-dark: #5A1A8B;

            /* Texto */
            --text-primary: #1E293B;
            --text-secondary: #64748B;
            --text-light: #F8FAFC;

            /* Espaciado */
            --spacing-xs: 4px;
            --spacing-sm: 8px;
            --spacing-md: 16px;
            --spacing-lg: 24px;
            --spacing-xl: 32px;
            --spacing-xxl: 48px;

            /* Bordes */
            --border-radius-sm: 6px;
            --border-radius: 12px;
            --border-radius-lg: 16px;
            --border-radius-xl: 24px;

            /* Sombras */
            --shadow-sm: 0 2px 4px rgba(0, 0, 0, 0.06);
            --shadow-md: 0 4px 6px rgba(0, 0, 0, 0.08);
            --shadow-lg: 0 10px 15px rgba(0, 0, 0, 0.1);
            --shadow-xl: 0 25px 50px rgba(0, 0, 0, 0.15);

            /* Transiciones */
            --transition-fast: 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            --transition-medium: 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            --transition-slow: 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #F8FAFC 0%, #E2E8F0 100%);
            color: var(--text-primary);
            line-height: 1.6;
            overflow-x: hidden;
            padding-bottom: 80px; /* Espacio para barra inferior móvil */
        }

        /* Header mejorado */
        .app-header {
            background: linear-gradient(135deg, var(--color-primary), var(--color-primary-dark));
            color: var(--text-light);
            padding: var(--spacing-md) var(--spacing-lg);
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: var(--shadow-lg);
            backdrop-filter: blur(20px);
        }

        .header-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1200px;
            margin: 0 auto;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
            font-weight: 700;
            font-size: 1.35rem;
        }

        .logo-icon {
            font-size: 1.75rem;
            color: var(--color-secondary);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        /* Indicador de progreso */
        .progress-indicator {
            background: var(--color-white);
            padding: var(--spacing-lg);
            box-shadow: var(--shadow-sm);
            position: sticky;
            top: 72px;
            z-index: 999;
        }

        .progress-container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .progress-steps {
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: relative;
            margin-bottom: var(--spacing-md);
        }

        .progress-line {
            position: absolute;
            top: 20px;
            left: 0;
            height: 3px;
            background: var(--color-gray-200);
            width: 100%;
            border-radius: 2px;
            z-index: 1;
        }

        .progress-line-active {
            position: absolute;
            top: 20px;
            left: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--color-primary), var(--color-secondary));
            border-radius: 2px;
            z-index: 2;
            transition: width var(--transition-medium);
            width: 0%;
        }

        .progress-step {
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
            z-index: 3;
            background: var(--color-white);
            padding: var(--spacing-xs);
            border-radius: var(--border-radius);
        }

        .progress-step-circle {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--color-gray-200);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 0.9rem;
            transition: all var(--transition-medium);
            margin-bottom: var(--spacing-xs);
        }

        .progress-step.active .progress-step-circle {
            background: var(--color-primary);
            color: var(--color-white);
            transform: scale(1.1);
            box-shadow: var(--shadow-md);
        }

        .progress-step.completed .progress-step-circle {
            background: var(--color-success);
            color: var(--color-white);
        }

        .progress-step-label {
            font-size: 0.8rem;
            color: var(--text-secondary);
            font-weight: 500;
            text-align: center;
        }

        .progress-step.active .progress-step-label {
            color: var(--color-primary);
            font-weight: 600;
        }

        /* Contenido principal */
        .main-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: var(--spacing-lg);
        }

        /* Pasos del proceso mejorados */
        .booking-process {
            margin-bottom: var(--spacing-xxl);
        }

        .step-container {
            position: relative;
            background: var(--color-white);
            border-radius: var(--border-radius-lg);
            box-shadow: var(--shadow-lg);
            padding: var(--spacing-xl);
            margin-bottom: var(--spacing-lg);
            transform: translateY(20px);
            opacity: 0;
            transition: all var(--transition-medium);
        }

        .step-container.active {
            transform: translateY(0);
            opacity: 1;
            animation: slideUp var(--transition-medium) ease-out;
        }

        .step-container.hidden {
            display: none;
        }

        @keyframes slideUp {
            from {
                transform: translateY(30px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .step-header {
            text-align: center;
            margin-bottom: var(--spacing-xl);
        }

        .step-title {
            font-size: 2rem;
            color: var(--color-primary);
            font-weight: 700;
            margin-bottom: var(--spacing-sm);
        }

        .step-subtitle {
            color: var(--text-secondary);
            font-size: 1.1rem;
            font-weight: 400;
        }

        /* Especialidades mejoradas */
        .specialties-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: var(--spacing-lg);
            margin-top: var(--spacing-xl);
        }

        .specialty-card {
            background: var(--color-white);
            border-radius: var(--border-radius-lg);
            box-shadow: var(--shadow-sm);
            padding: var(--spacing-xl);
            cursor: pointer;
            transition: all var(--transition-medium);
            border: 2px solid transparent;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .specialty-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.8), transparent);
            transition: left var(--transition-slow);
        }

        .specialty-card:hover {
            transform: translateY(-8px);
            box-shadow: var(--shadow-xl);
            border-color: var(--color-primary);
        }

        .specialty-card:hover::before {
            left: 100%;
        }

        .specialty-card.active {
            border-color: var(--color-primary);
            background: linear-gradient(135deg, var(--color-primary), var(--color-primary-light));
            color: var(--color-white);
            transform: translateY(-8px) scale(1.02);
        }

        .specialty-icon {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, var(--color-primary), var(--color-secondary));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto var(--spacing-lg);
            color: var(--color-white);
            font-size: 2rem;
            transition: all var(--transition-medium);
        }

        .specialty-card.active .specialty-icon {
            background: var(--color-white);
            color: var(--color-primary);
            transform: scale(1.1);
        }

        .specialty-name {
            font-weight: 600;
            font-size: 1.2rem;
            margin-bottom: var(--spacing-sm);
        }

        .specialty-desc {
            font-size: 0.9rem;
            opacity: 0.8;
        }

        /* Doctores mejorados */
        .doctors-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: var(--spacing-lg);
            margin-top: var(--spacing-xl);
        }

        .doctor-card {
            background: var(--color-white);
            border-radius: var(--border-radius-lg);
            box-shadow: var(--shadow-sm);
            cursor: pointer;
            transition: all var(--transition-medium);
            border: 2px solid transparent;
            overflow: hidden;
            position: relative;
        }

        .doctor-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-xl);
            border-color: var(--color-primary);
        }

        .doctor-card.active {
            border-color: var(--color-primary);
            transform: translateY(-5px);
            box-shadow: var(--shadow-xl);
        }

        .doctor-image {
            width: 100%;
            height: 200px;
            background: linear-gradient(135deg, var(--color-gray-100), var(--color-gray-200));
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--color-gray-400);
            position: relative;
            overflow: hidden;
        }

        .doctor-badge {
            position: absolute;
            top: var(--spacing-md);
            right: var(--spacing-md);
            background: var(--color-secondary);
            color: var(--color-white);
            padding: var(--spacing-xs) var(--spacing-sm);
            border-radius: var(--border-radius);
            font-size: 0.8rem;
            font-weight: 600;
            box-shadow: var(--shadow-sm);
        }

        .doctor-info {
            padding: var(--spacing-lg);
        }

        .doctor-name {
            font-weight: 700;
            font-size: 1.3rem;
            margin-bottom: var(--spacing-xs);
            color: var(--color-primary);
        }

        .doctor-specialty {
            color: var(--color-secondary);
            font-size: 1rem;
            margin-bottom: var(--spacing-md);
            font-weight: 500;
        }

        .doctor-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--spacing-md);
        }

        .doctor-rating {
            color: var(--color-warning);
            font-size: 1rem;
            display: flex;
            align-items: center;
            gap: var(--spacing-xs);
            font-weight: 500;
        }

        .doctor-price {
            font-weight: 700;
            font-size: 1.2rem;
            color: var(--color-primary);
        }

        .doctor-bio {
            font-size: 0.9rem;
            color: var(--text-secondary);
            line-height: 1.5;
        }

        /* Calendario mejorado */
        .calendar-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: var(--spacing-xl);
            margin-top: var(--spacing-xl);
        }

        @media (max-width: 768px) {
            .calendar-section {
                grid-template-columns: 1fr;
            }
        }

        .calendar-container {
            background: var(--color-white);
            border-radius: var(--border-radius-lg);
            box-shadow: var(--shadow-sm);
            padding: var(--spacing-lg);
        }

        .time-slots-section {
            background: var(--color-white);
            border-radius: var(--border-radius-lg);
            box-shadow: var(--shadow-sm);
            padding: var(--spacing-lg);
        }

        .section-label {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--color-primary);
            margin-bottom: var(--spacing-md);
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
        }

        .time-slots {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: var(--spacing-sm);
        }

        .time-slot {
            padding: var(--spacing-md);
            background: var(--color-gray-100);
            border: 2px solid transparent;
            border-radius: var(--border-radius);
            text-align: center;
            cursor: pointer;
            transition: all var(--transition-fast);
            font-weight: 500;
            font-size: 0.95rem;
        }

        .time-slot:hover {
            border-color: var(--color-primary);
            background: var(--color-primary);
            color: var(--color-white);
            transform: translateY(-2px);
        }

        .time-slot.selected {
            background: var(--color-primary);
            color: var(--color-white);
            border-color: var(--color-primary);
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .time-slot.unavailable {
            background: var(--color-gray-200);
            color: var(--color-gray-400);
            cursor: not-allowed;
            text-decoration: line-through;
        }

        /* Tipo de consulta */
        .consultation-type {
            margin-top: var(--spacing-xl);
            padding-top: var(--spacing-lg);
            border-top: 1px solid var(--color-gray-200);
        }

        .consultation-options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: var(--spacing-md);
            margin-top: var(--spacing-md);
        }

        .consultation-option {
            background: var(--color-white);
            border: 2px solid var(--color-gray-200);
            border-radius: var(--border-radius-lg);
            padding: var(--spacing-lg);
            cursor: pointer;
            transition: all var(--transition-fast);
            text-align: center;
        }

        .consultation-option:hover {
            border-color: var(--color-primary);
            transform: translateY(-2px);
        }

        .consultation-option.active {
            border-color: var(--color-primary);
            background: linear-gradient(135deg, var(--color-primary), var(--color-primary-light));
            color: var(--color-white);
            transform: translateY(-2px);
        }

        /* Pasarela de pago */
        .payment-section {
            background: var(--color-white);
            border-radius: var(--border-radius-lg);
            box-shadow: var(--shadow-lg);
            padding: var(--spacing-xl);
            margin-top: var(--spacing-xl);
        }

        .payment-header {
            text-align: center;
            margin-bottom: var(--spacing-xl);
        }

        .payment-title {
            font-size: 1.8rem;
            color: var(--color-primary);
            font-weight: 700;
            margin-bottom: var(--spacing-sm);
        }

        .payment-amount {
            font-size: 2.5rem;
            color: var(--color-success);
            font-weight: 800;
            margin-bottom: var(--spacing-sm);
        }

        .payment-note {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .payment-methods {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: var(--spacing-md);
            margin: var(--spacing-xl) 0;
        }

        .payment-method {
            background: var(--color-gray-50);
            border: 2px solid var(--color-gray-200);
            border-radius: var(--border-radius-lg);
            padding: var(--spacing-lg);
            cursor: pointer;
            transition: all var(--transition-fast);
            text-align: center;
            position: relative;
        }

        .payment-method:hover {
            border-color: var(--color-primary);
            transform: translateY(-2px);
        }

        .payment-method.active {
            border-color: var(--color-primary);
            background: var(--color-primary);
            color: var(--color-white);
        }

        /* Estilos específicos para Yape */
        .payment-method[data-method="yape"] {
            background: linear-gradient(135deg, var(--color-yape-light), var(--color-yape));
            color: var(--color-white);
            border-color: var(--color-yape);
        }

        .payment-method[data-method="yape"]:hover {
            border-color: var(--color-yape-dark);
            background: linear-gradient(135deg, var(--color-yape), var(--color-yape-dark));
        }

        .payment-method[data-method="yape"].active {
            background: linear-gradient(135deg, var(--color-yape-dark), var(--color-yape));
            border-color: var(--color-yape-dark);
            box-shadow: 0 8px 25px rgba(123, 44, 191, 0.3);
        }

        .payment-method-icon {
            font-size: 2rem;
            margin-bottom: var(--spacing-sm);
        }

        .payment-form {
            display: none;
            animation: fadeIn var(--transition-medium);
        }

        .payment-form.active {
            display: block;
        }

        .form-group {
            margin-bottom: var(--spacing-lg);
        }

        .form-label {
            display: block;
            font-weight: 600;
            margin-bottom: var(--spacing-sm);
            color: var(--color-primary);
        }

        .form-input {
            width: 100%;
            padding: var(--spacing-md);
            border: 2px solid var(--color-gray-200);
            border-radius: var(--border-radius);
            font-size: 1rem;
            transition: all var(--transition-fast);
        }

        .form-input:focus {
            outline: none;
            border-color: var(--color-primary);
            box-shadow: 0 0 0 3px rgba(0, 102, 204, 0.1);
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: var(--spacing-md);
        }

        /* Yape QR Code Section */
        .yape-qr-section {
            text-align: center;
            background: linear-gradient(135deg, var(--color-yape-light), var(--color-yape));
            color: var(--color-white);
            padding: var(--spacing-xl);
            border-radius: var(--border-radius-lg);
            margin-bottom: var(--spacing-lg);
        }

        .yape-qr-code {
            width: 200px;
            height: 200px;
            background: var(--color-white);
            border-radius: var(--border-radius);
            margin: var(--spacing-lg) auto;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            box-shadow: var(--shadow-lg);
        }

        .yape-qr-placeholder {
            font-size: 4rem;
            color: var(--color-yape);
            animation: pulse 2s infinite;
        }

        .yape-instructions {
            background: var(--color-white);
            color: var(--text-primary);
            padding: var(--spacing-lg);
            border-radius: var(--border-radius);
            margin-top: var(--spacing-lg);
        }

        .yape-steps {
            text-align: left;
            margin-top: var(--spacing-md);
        }

        .yape-step {
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
            margin-bottom: var(--spacing-md);
            padding: var(--spacing-sm);
            background: var(--color-gray-50);
            border-radius: var(--border-radius);
        }

        .yape-step-number {
            width: 30px;
            height: 30px;
            background: var(--color-yape);
            color: var(--color-white);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 0.9rem;
            flex-shrink: 0;
        }

        .yape-timer {
            background: var(--color-warning);
            color: var(--color-white);
            padding: var(--spacing-sm) var(--spacing-md);
            border-radius: var(--border-radius);
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: var(--spacing-sm);
            margin-top: var(--spacing-md);
        }

        /* Barra de navegación inferior móvil */
        .mobile-bottom-nav {
            display: none;
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--color-white);
            border-top: 1px solid var(--color-gray-200);
            padding: var(--spacing-sm) var(--spacing-md);
            z-index: 1000;
            box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.1);
        }

        @media (max-width: 768px) {
            .mobile-bottom-nav {
                display: flex;
                justify-content: space-between;
                align-items: center;
            }
        }

        .nav-button {
            background: var(--color-primary);
            color: var(--color-white);
            border: none;
            border-radius: var(--border-radius);
            padding: var(--spacing-md) var(--spacing-lg);
            font-weight: 600;
            cursor: pointer;
            transition: all var(--transition-fast);
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
        }

        .nav-button:disabled {
            background: var(--color-gray-300);
            cursor: not-allowed;
        }

        .nav-button.secondary {
            background: var(--color-gray-200);
            color: var(--text-primary);
        }

        /* Botones principales mejorados */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: var(--spacing-md) var(--spacing-xl);
            border-radius: var(--border-radius-lg);
            border: none;
            font-weight: 600;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all var(--transition-fast);
            text-align: center;
            gap: var(--spacing-sm);
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
            transition: left var(--transition-medium);
        }

        .btn:hover::before {
            left: 100%;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--color-primary), var(--color-primary-light));
            color: var(--color-white);
            box-shadow: var(--shadow-md);
        }

        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-xl);
        }

        .btn-primary:disabled {
            background: var(--color-gray-300);
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .btn-success {
            background: linear-gradient(135deg, var(--color-success), #00E676);
            color: var(--color-white);
            box-shadow: var(--shadow-md);
        }

        .btn-success:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-xl);
        }

        .btn-yape {
            background: linear-gradient(135deg, var(--color-yape), var(--color-yape-light));
            color: var(--color-white);
            box-shadow: var(--shadow-md);
        }

        .btn-yape:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(123, 44, 191, 0.3);
        }

        /* Modal mejorado y responsivo */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            opacity: 0;
            pointer-events: none;
            transition: opacity var(--transition-medium);
            padding: var(--spacing-md);
            backdrop-filter: blur(15px);
        }

        .modal-overlay.active {
            opacity: 1;
            pointer-events: all;
        }

        .modal-content {
            background: var(--color-white);
            border-radius: var(--border-radius-xl);
            padding: var(--spacing-lg);
            max-width: 500px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: var(--shadow-xl);
            transform: translateY(30px) scale(0.9);
            transition: transform var(--transition-medium);
            position: relative;
        }

        .modal-overlay.active .modal-content {
            transform: translateY(0) scale(1);
        }

        .modal-close {
            position: absolute;
            top: var(--spacing-md);
            right: var(--spacing-md);
            background: var(--color-gray-100);
            border: none;
            border-radius: 50%;
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.1rem;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all var(--transition-fast);
            z-index: 10;
        }

        .modal-close:hover {
            background: var(--color-error);
            color: var(--color-white);
        }

        .modal-header {
            text-align: center;
            margin-bottom: var(--spacing-lg);
            padding-top: var(--spacing-sm);
        }

        .modal-icon {
            width: 70px;
            height: 70px;
            background: linear-gradient(135deg, var(--color-success), #00E676);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--color-white);
            font-size: 2rem;
            margin: 0 auto var(--spacing-md);
            animation: bounceIn 0.6s ease-out;
        }

        @keyframes bounceIn {
            0% { transform: scale(0); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }

        .modal-title {
            font-size: 1.5rem;
            color: var(--color-success);
            margin-bottom: var(--spacing-sm);
            font-weight: 700;
        }

        .modal-subtitle {
            color: var(--text-secondary);
            font-size: 0.95rem;
            margin-bottom: var(--spacing-lg);
        }

        .appointment-card {
            background: linear-gradient(135deg, var(--color-primary), var(--color-primary-light));
            color: var(--color-white);
            border-radius: var(--border-radius-lg);
            padding: var(--spacing-lg);
            margin-bottom: var(--spacing-lg);
            box-shadow: var(--shadow-md);
        }

        .appointment-main-info {
            text-align: center;
            margin-bottom: var(--spacing-lg);
        }

        .appointment-date-time {
            background: rgba(255, 255, 255, 0.2);
            border-radius: var(--border-radius);
            padding: var(--spacing-md);
            margin-bottom: var(--spacing-md);
            backdrop-filter: blur(10px);
        }

        .appointment-date {
            font-size: 1.4rem;
            font-weight: 700;
            margin-bottom: var(--spacing-xs);
        }

        .appointment-time {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .appointment-details {
            display: grid;
            gap: var(--spacing-sm);
        }

        .appointment-detail {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--spacing-xs) 0;
        }

        .appointment-detail-label {
            font-size: 0.9rem;
            opacity: 0.8;
        }

        .appointment-detail-value {
            font-weight: 600;
            text-align: right;
            flex: 1;
            margin-left: var(--spacing-md);
        }

        .payment-confirmation {
            background: var(--color-success);
            border-radius: var(--border-radius);
            padding: var(--spacing-md);
            margin-bottom: var(--spacing-lg);
            text-align: center;
            color: var(--color-white);
        }

        .payment-method-badge {
            display: inline-flex;
            align-items: center;
            gap: var(--spacing-xs);
            background: rgba(255, 255, 255, 0.2);
            padding: var(--spacing-xs) var(--spacing-sm);
            border-radius: var(--border-radius);
            font-size: 0.85rem;
            margin-top: var(--spacing-xs);
        }

        .important-info {
            background: var(--color-gray-50);
            border-left: 4px solid var(--color-warning);
            padding: var(--spacing-md);
            border-radius: 0 var(--border-radius) var(--border-radius) 0;
            margin-bottom: var(--spacing-lg);
        }

        .important-info-title {
            font-weight: 600;
            color: var(--color-warning);
            margin-bottom: var(--spacing-xs);
            display: flex;
            align-items: center;
            gap: var(--spacing-xs);
        }

        .important-info-list {
            font-size: 0.9rem;
            color: var(--text-secondary);
            line-height: 1.5;
        }

        .important-info-list li {
            margin-bottom: var(--spacing-xs);
        }

        .modal-actions {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-sm);
        }

        .action-button {
            padding: var(--spacing-md) var(--spacing-lg);
            border-radius: var(--border-radius);
            border: none;
            font-weight: 600;
            cursor: pointer;
            transition: all var(--transition-fast);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: var(--spacing-sm);
            font-size: 0.95rem;
        }

        .action-button.primary {
            background: linear-gradient(135deg, var(--color-primary), var(--color-primary-light));
            color: var(--color-white);
            box-shadow: var(--shadow-md);
        }

        .action-button.secondary {
            background: var(--color-gray-100);
            color: var(--text-primary);
            border: 1px solid var(--color-gray-200);
        }

        .action-button:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        /* Responsive para móvil */
        @media (max-width: 768px) {
            .modal-overlay {
                padding: var(--spacing-sm);
                align-items: flex-start;
                padding-top: var(--spacing-lg);
            }

            .modal-content {
                padding: var(--spacing-md);
                max-height: 85vh;
                border-radius: var(--border-radius-lg);
            }

            .modal-close {
                top: var(--spacing-sm);
                right: var(--spacing-sm);
                width: 32px;
                height: 32px;
                font-size: 1rem;
            }

            .modal-icon {
                width: 60px;
                height: 60px;
                font-size: 1.8rem;
            }

            .modal-title {
                font-size: 1.3rem;
            }

            .appointment-card {
                padding: var(--spacing-md);
            }

            .appointment-date {
                font-size: 1.2rem;
            }

            .appointment-time {
                font-size: 1rem;
            }

            .appointment-detail {
                flex-direction: column;
                align-items: flex-start;
                gap: var(--spacing-xs);
                padding: var(--spacing-sm) 0;
                border-bottom: 1px solid rgba(255, 255, 255, 0.2);
            }

            .appointment-detail:last-child {
                border-bottom: none;
            }

            .appointment-detail-value {
                margin-left: 0;
                text-align: left;
                font-size: 1.05rem;
            }

            .important-info {
                padding: var(--spacing-sm);
            }

            .important-info-list {
                font-size: 0.85rem;
            }

            .action-button {
                padding: var(--spacing-md);
                font-size: 0.9rem;
            }
        }

        /* Muy pequeño (320px) */
        @media (max-width: 400px) {
            .modal-overlay {
                padding: var(--spacing-xs);
                padding-top: var(--spacing-md);
            }

            .modal-content {
                padding: var(--spacing-sm);
                max-height: 90vh;
            }

            .appointment-card {
                padding: var(--spacing-sm);
            }

            .modal-title {
                font-size: 1.2rem;
            }

            .appointment-date {
                font-size: 1.1rem;
            }
        }

        /* Animaciones adicionales */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .fade-in {
            animation: fadeIn var(--transition-medium) ease-out;
        }

        /* Loading animation */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: var(--color-white);
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Responsive mejoras */
        @media (max-width: 768px) {
            .main-container {
                padding: var(--spacing-md);
            }

            .step-container {
                padding: var(--spacing-lg);
            }

            .step-title {
                font-size: 1.5rem;
            }

            .specialties-grid {
                grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
                gap: var(--spacing-md);
            }

            .doctors-grid {
                grid-template-columns: 1fr;
            }

            .consultation-options {
                grid-template-columns: 1fr;
            }

            .payment-methods {
                grid-template-columns: repeat(2, 1fr);
            }

            .form-row {
                grid-template-columns: 1fr;
            }

            .yape-qr-code {
                width: 150px;
                height: 150px;
            }
        }

        /* Estados de carga y feedback */
        .processing {
            position: relative;
            pointer-events: none;
        }

        .processing::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: inherit;
        }
    </style>
</head>

<body>
    <!-- Header -->
    <header class="app-header">
        <div class="header-container">
            <div class="logo">
                <span class="logo-icon"><i class="fas fa-heartbeat"></i></span>
                <span>SaludPlus</span>
            </div>
            <div class="user-actions">
                <div class="user-icon">
                    <i class="fas fa-user"></i>
                </div>
            </div>
        </div>
    </header>

    <!-- Indicador de progreso -->
    <div class="progress-indicator">
        <div class="progress-container">
            <div class="progress-steps">
                <div class="progress-line"></div>
                <div class="progress-line-active" id="progress-line"></div>
                
                <div class="progress-step active" id="progress-1">
                    <div class="progress-step-circle">1</div>
                    <div class="progress-step-label">Especialidad</div>
                </div>
                
                <div class="progress-step" id="progress-2">
                    <div class="progress-step-circle">2</div>
                    <div class="progress-step-label">Médico</div>
                </div>
                
                <div class="progress-step" id="progress-3">
                    <div class="progress-step-circle">3</div>
                    <div class="progress-step-label">Horario</div>
                </div>
                
                <div class="progress-step" id="progress-4">
                    <div class="progress-step-circle">4</div>
                    <div class="progress-step-label">Pago</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Contenido principal -->
    <div class="main-container">
        <section class="booking-process">
            <!-- Paso 1: Especialidades -->
            <div class="step-container active" id="step-specialty">
                <div class="step-header">
                    <h2 class="step-title">¿Qué tipo de consulta necesitas?</h2>
                    <p class="step-subtitle">Selecciona la especialidad médica que mejor se adapte a tus necesidades</p>
                </div>

                <div class="specialties-grid" id="specialties-grid">
                    <!-- Se llenan dinámicamente -->
                </div>
            </div>

            <!-- Paso 2: Doctores -->
            <div class="step-container hidden" id="step-doctor">
                <div class="step-header">
                    <h2 class="step-title">Elige tu médico especialista</h2>
                    <p class="step-subtitle">Profesionales altamente calificados y con excelentes reseñas</p>
                </div>

                <div class="doctors-grid" id="doctors-grid">
                    <!-- Se llenan dinámicamente -->
                </div>
            </div>

            <!-- Paso 3: Horarios -->
            <div class="step-container hidden" id="step-schedule">
                <div class="step-header">
                    <h2 class="step-title">Selecciona fecha y hora</h2>
                    <p class="step-subtitle">Encuentra el horario perfecto para tu consulta médica</p>
                </div>

                <div class="calendar-section">
                    <div class="calendar-container">
                        <h3 class="section-label">
                            <i class="fas fa-calendar-alt"></i>
                            Calendario
                        </h3>
                        <input type="text" id="datepicker" placeholder="Haz clic para seleccionar fecha" readonly>
                    </div>

                    <div class="time-slots-section">
                        <h3 class="section-label">
                            <i class="fas fa-clock"></i>
                            Horarios disponibles
                        </h3>
                        <div class="time-slots" id="time-slots">
                            <!-- Se llenan dinámicamente -->
                        </div>
                    </div>
                </div>

                <div class="consultation-type">
                    <h3 class="section-label">
                        <i class="fas fa-stethoscope"></i>
                        Tipo de consulta
                    </h3>
                    <div class="consultation-options">
                        <div class="consultation-option active" data-type="normal">
                            <i class="fas fa-user-md" style="font-size: 2rem; margin-bottom: 8px; color: var(--color-primary);"></i>
                            <h4>Consulta Normal</h4>
                            <p>$50</p>
                        </div>
                        <div class="consultation-option" data-type="urgent">
                            <i class="fas fa-ambulance" style="font-size: 2rem; margin-bottom: 8px; color: var(--color-accent);"></i>
                            <h4>Consulta Urgente</h4>
                            <p>$70 (+$20)</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Paso 4: Pago -->
            <div class="step-container hidden" id="step-payment">
                <div class="step-header">
                    <h2 class="step-title">Confirma y paga tu cita</h2>
                    <p class="step-subtitle">Paga el 50% ahora y el resto en consulta</p>
                </div>

                <!-- Resumen de la cita -->
                <div class="appointment-summary" id="appointment-summary">
                    <!-- Se llena dinámicamente -->
                </div>

                <!-- Sección de pago -->
                <div class="payment-section">
                    <div class="payment-header">
                        <h3 class="payment-title">Total a pagar ahora:</h3>
                        <div class="payment-amount" id="payment-amount">$25</div>
                        <p class="payment-note">Paga el 50% para confirmar tu reserva</p>
                    </div>

                    <div class="payment-methods">
                        <div class="payment-method active" data-method="card">
                            <div class="payment-method-icon">
                                <i class="fas fa-credit-card"></i>
                            </div>
                            <h4>Tarjeta de Crédito/Débito</h4>
                        </div>
                        <div class="payment-method" data-method="yape">
                            <div class="payment-method-icon">
                                <i class="fas fa-mobile-alt"></i>
                            </div>
                            <h4>Yape</h4>
                            <small>¡Pago instantáneo!</small>
                        </div>
                        <div class="payment-method" data-method="paypal">
                            <div class="payment-method-icon">
                                <i class="fab fa-paypal"></i>
                            </div>
                            <h4>PayPal</h4>
                        </div>
                        <div class="payment-method" data-method="transfer">
                            <div class="payment-method-icon">
                                <i class="fas fa-university"></i>
                            </div>
                            <h4>Transferencia</h4>
                        </div>
                    </div>

                    <!-- Formulario de tarjeta -->
                    <div class="payment-form active" id="card-form">
                        <div class="form-group">
                            <label class="form-label">Número de tarjeta</label>
                            <input type="text" class="form-input" placeholder="1234 5678 9012 3456" maxlength="19">
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Vencimiento</label>
                                <input type="text" class="form-input" placeholder="MM/AA" maxlength="5">
                            </div>
                            <div class="form-group">
                                <label class="form-label">CVV</label>
                                <input type="text" class="form-input" placeholder="123" maxlength="4">
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Nombre del titular</label>
                            <input type="text" class="form-input" placeholder="Como aparece en la tarjeta">
                        </div>
                    </div>

                    <!-- Formulario de Yape -->
                    <div class="payment-form" id="yape-form">
                        <div class="yape-qr-section">
                            <h3 style="margin-bottom: var(--spacing-md);">
                                <i class="fas fa-mobile-alt"></i> Pagar con Yape
                            </h3>
                            <p style="margin-bottom: var(--spacing-lg); opacity: 0.9;">
                                Escanea el código QR con tu app de Yape
                            </p>
                            <div class="yape-qr-code">
                                <div class="yape-qr-placeholder">
                                    <i class="fas fa-qrcode"></i>
                                </div>
                            </div>
                            <div class="yape-timer">
                                <i class="fas fa-clock"></i>
                                <span id="yape-countdown">14:59</span>
                            </div>
                        </div>
                        
                        <div class="yape-instructions">
                            <h4 style="color: var(--color-yape); margin-bottom: var(--spacing-md);">
                                <i class="fas fa-info-circle"></i> Instrucciones
                            </h4>
                            <div class="yape-steps">
                                <div class="yape-step">
                                    <div class="yape-step-number">1</div>
                                    <div>Abre tu app de Yape y selecciona "Pagar con QR"</div>
                                </div>
                                <div class="yape-step">
                                    <div class="yape-step-number">2</div>
                                    <div>Escanea el código QR mostrado arriba</div>
                                </div>
                                <div class="yape-step">
                                    <div class="yape-step-number">3</div>
                                    <div>Confirma el monto de <strong id="yape-amount">S/. 93.50</strong></div>
                                </div>
                                <div class="yape-step">
                                    <div class="yape-step-number">4</div>
                                    <div>Completa el pago en tu app de Yape</div>
                                </div>
                            </div>
                            <div style="background: var(--color-gray-50); padding: var(--spacing-md); border-radius: var(--border-radius); margin-top: var(--spacing-lg); text-align: center;">
                                <small style="color: var(--text-secondary);">
                                    <i class="fas fa-shield-alt"></i>
                                    Tu pago está protegido y es completamente seguro
                                </small>
                            </div>
                        </div>
                    </div>

                    <!-- Formulario de PayPal -->
                    <div class="payment-form" id="paypal-form">
                        <div class="form-group">
                            <label class="form-label">Email de PayPal</label>
                            <input type="email" class="form-input" placeholder="tu@email.com">
                        </div>
                    </div>

                    <!-- Formulario de transferencia -->
                    <div class="payment-form" id="transfer-form">
                        <div class="form-group">
                            <label class="form-label">Banco</label>
                            <select class="form-input">
                                <option>Selecciona tu banco</option>
                                <option>Banco de la Nación</option>
                                <option>BCP</option>
                                <option>BBVA</option>
                                <option>Interbank</option>
                                <option>Scotiabank</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Número de cuenta</label>
                            <input type="text" class="form-input" placeholder="Ingresa tu número de cuenta">
                        </div>
                    </div>

                    <button class="btn btn-success" id="btn-pay" style="width: 100%; margin-top: 2rem;">
                        <i class="fas fa-lock"></i>
                        <span id="pay-button-text">Pagar y Confirmar Cita</span>
                    </button>
                </div>
            </div>
        </section>
    </div>

    <!-- Barra de navegación inferior móvil -->
    <div class="mobile-bottom-nav">
        <button class="nav-button secondary" id="mobile-back" style="display: none;">
            <i class="fas fa-arrow-left"></i>
            Atrás
        </button>
        <button class="nav-button" id="mobile-next" disabled>
            Siguiente
            <i class="fas fa-arrow-right"></i>
        </button>
    </div>

    <!-- Modal de confirmación -->
    <div class="modal-overlay" id="confirmation-modal">
        <div class="modal-content">
            <button class="modal-close" onclick="closeModal()">&times;</button>
            
            <div class="modal-header">
                <div class="modal-icon">
                    <i class="fas fa-check-circle"></i>
                </div>
                <h3 class="modal-title">¡Cita Confirmada!</h3>
                <p class="modal-subtitle">Tu reserva ha sido procesada exitosamente</p>
            </div>

            <div class="appointment-card">
                <div class="appointment-main-info">
                    <div class="appointment-date-time">
                        <div class="appointment-date" id="modal-date">Miércoles 15 de Enero</div>
                        <div class="appointment-time" id="modal-time">10:30 AM</div>
                    </div>
                </div>

                <div class="appointment-details">
                    <div class="appointment-detail">
                        <span class="appointment-detail-label">
                            <i class="fas fa-user-md"></i> Médico
                        </span>
                        <span class="appointment-detail-value" id="modal-doctor">Dr. Juan Pérez</span>
                    </div>
                    <div class="appointment-detail">
                        <span class="appointment-detail-label">
                            <i class="fas fa-stethoscope"></i> Especialidad
                        </span>
                        <span class="appointment-detail-value" id="modal-specialty">Medicina General</span>
                    </div>
                    <div class="appointment-detail">
                        <span class="appointment-detail-label">
                            <i class="fas fa-map-marker-alt"></i> Consultorio
                        </span>
                        <span class="appointment-detail-value" id="modal-office">Consultorio #5</span>
                    </div>
                    <div class="appointment-detail">
                        <span class="appointment-detail-label">
                            <i class="fas fa-clipboard-list"></i> Tipo
                        </span>
                        <span class="appointment-detail-value" id="modal-type">Consulta Normal</span>
                    </div>
                    <div class="appointment-detail">
                        <span class="appointment-detail-label">
                            <i class="fas fa-dollar-sign"></i> Total
                        </span>
                        <span class="appointment-detail-value" id="modal-total">$50.00</span>
                    </div>
                </div>
            </div>

            <div class="payment-confirmation">
                <div style="font-weight: 600; margin-bottom: var(--spacing-xs);">
                    <i class="fas fa-check-circle"></i> Pago Confirmado
                </div>
                <div style="font-size: 0.9rem; opacity: 0.9;" id="modal-payment-info">
                    Pagaste $25.00 • Resta $25.00 en consulta
                </div>
                <div class="payment-method-badge" id="modal-payment-method">
                    <i class="fas fa-credit-card"></i>
                    <span>Tarjeta de Crédito</span>
                </div>
            </div>

            <div class="important-info">
                <div class="important-info-title">
                    <i class="fas fa-exclamation-circle"></i>
                    Información Importante
                </div>
                <ul class="important-info-list">
                    <li>📧 <strong>Confirmación enviada</strong> a tu correo electrónico</li>
                    <li>⏰ <strong>Llega 15 minutos antes</strong> de tu cita</li>
                    <li>🆔 <strong>Trae tu DNI</strong> y comprobante de pago</li>
                    <li>💰 <strong>Paga el resto</strong> ($<span id="modal-remaining">25</span>) en recepción</li>
                    <li>📱 <strong>Código de cita:</strong> #<span id="modal-code">SLD2025-001</span></li>
                </ul>
            </div>

            <div class="modal-actions">
                <button class="action-button primary" onclick="downloadAppointment()">
                    <i class="fas fa-download"></i>
                    Descargar Comprobante
                </button>
                <button class="action-button secondary" onclick="addToCalendar()">
                    <i class="fas fa-calendar-plus"></i>
                    Agregar al Calendario
                </button>
                <button class="action-button secondary" onclick="resetFlow()">
                    <i class="fas fa-home"></i>
                    Nueva Cita
                </button>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"></script>
    <script>
        $(document).ready(function () {
            // Datos mejorados
            const specialties = [
                {
                    id: "general",
                    name: "Medicina General",
                    icon: "user-md",
                    description: "Atención primaria y chequeos médicos generales",
                    doctors: [
                        {
                            id: "doc-1",
                            name: "Dr. Juan Pérez González",
                            specialty: "Medicina General",
                            rating: 4.9,
                            price: 50,
                            bio: "Especialista con más de 15 años de experiencia en atención primaria. Graduado con honores de la Universidad Nacional Mayor de San Marcos.",
                            badge: "Disponible hoy"
                        },
                        {
                            id: "doc-2",
                            name: "Dra. María Elena Gómez",
                            specialty: "Medicina Familiar",
                            rating: 4.8,
                            price: 55,
                            bio: "Especializada en atención integral familiar. Certificada en medicina preventiva y cuidados paliativos.",
                            badge: "⭐ Popular"
                        }
                    ]
                },
                {
                    id: "cardiologia",
                    name: "Cardiología",
                    icon: "heartbeat",
                    description: "Especialistas en salud cardiovascular y prevención",
                    doctors: [
                        {
                            id: "doc-3",
                            name: "Dr. Carlos Mendoza",
                            specialty: "Cardiología Clínica",
                            rating: 4.7,
                            price: 80,
                            bio: "Cardiólogo intervencionista con experiencia en procedimientos mínimamente invasivos.",
                            badge: "Especialista"
                        }
                    ]
                },
                {
                    id: "dermatologia",
                    name: "Dermatología",
                    icon: "allergies",
                    description: "Cuidado especializado de la piel y tratamientos estéticos",
                    doctors: [
                        {
                            id: "doc-4",
                            name: "Dra. Ana Sofía Ruiz",
                            specialty: "Dermatología Cosmética",
                            rating: 4.9,
                            price: 70,
                            bio: "Especialista en dermatología estética y tratamientos anti-aging con tecnología láser.",
                            badge: "🔥 Trending"
                        }
                    ]
                },
                {
                    id: "pediatria",
                    name: "Pediatría",
                    icon: "baby",
                    description: "Atención médica especializada para niños y adolescentes",
                    doctors: [
                        {
                            id: "doc-5",
                            name: "Dr. Roberto Silva",
                            specialty: "Pediatría General",
                            rating: 4.8,
                            price: 60,
                            bio: "Pediatra con enfoque en desarrollo infantil y medicina preventiva pediátrica.",
                            badge: "Recomendado"
                        }
                    ]
                },
                {
                    id: "ginecologia",
                    name: "Ginecología",
                    icon: "female",
                    description: "Salud integral de la mujer en todas las etapas",
                    doctors: [
                        {
                            id: "doc-6",
                            name: "Dra. Patricia Morales",
                            specialty: "Ginecología y Obstetricia",
                            rating: 4.9,
                            price: 75,
                            bio: "Especialista en salud reproductiva femenina y embarazos de alto riesgo.",
                            badge: "Experta"
                        }
                    ]
                },
                {
                    id: "oftalmologia",
                    name: "Oftalmología",
                    icon: "eye",
                    description: "Cuidado completo de la salud visual",
                    doctors: [
                        {
                            id: "doc-7",
                            name: "Dr. Miguel Torres",
                            specialty: "Oftalmología",
                            rating: 4.7,
                            price: 65,
                            bio: "Especialista en cirugía refractiva y tratamiento de cataratas con técnicas avanzadas.",
                            badge: "Cirujano"
                        }
                    ]
                }
            ];

            // Variables de estado
            let currentStep = 1;
            let selectedSpecialty = null;
            let selectedDoctor = null;
            let selectedDate = null;
            let selectedTime = null;
            let consultationType = 'normal';
            let paymentMethod = 'card';
            let yapeCountdown = null;

            // Inicializar aplicación
            initializeApp();

            function initializeApp() {
                loadSpecialties();
                setupDatePicker();
                setupEventListeners();
                updateProgress();
            }

            function loadSpecialties() {
                const $grid = $("#specialties-grid");
                $grid.empty();

                specialties.forEach(specialty => {
                    $grid.append(`
                        <div class="specialty-card" data-specialty="${specialty.id}">
                            <div class="specialty-icon">
                                <i class="fas fa-${specialty.icon}"></i>
                            </div>
                            <h3 class="specialty-name">${specialty.name}</h3>
                            <p class="specialty-desc">${specialty.description}</p>
                        </div>
                    `);
                });

                // Auto-avanzar al seleccionar especialidad
                $(".specialty-card").click(function() {
                    $(".specialty-card").removeClass("active");
                    $(this).addClass("active");

                    const specialtyId = $(this).data("specialty");
                    selectedSpecialty = specialties.find(s => s.id === specialtyId);

                    // Avanzar automáticamente después de una pequeña pausa
                    setTimeout(() => {
                        nextStep();
                    }, 800);
                });
            }

            function loadDoctors() {
                const $grid = $("#doctors-grid");
                $grid.empty();

                if (!selectedSpecialty?.doctors) return;

                selectedSpecialty.doctors.forEach(doctor => {
                    $grid.append(`
                        <div class="doctor-card" data-doctor-id="${doctor.id}">
                            <div class="doctor-image">
                                <div class="doctor-badge">${doctor.badge}</div>
                                <i class="fas fa-user-md" style="font-size: 4rem;"></i>
                            </div>
                            <div class="doctor-info">
                                <h3 class="doctor-name">${doctor.name}</h3>
                                <p class="doctor-specialty">${doctor.specialty}</p>
                                <div class="doctor-meta">
                                    <div class="doctor-rating">
                                        ${getRatingStars(doctor.rating)} ${doctor.rating}
                                    </div>
                                    <div class="doctor-price">${doctor.price}</div>
                                </div>
                                <p class="doctor-bio">${doctor.bio}</p>
                            </div>
                        </div>
                    `);
                });

                // Auto-avanzar al seleccionar doctor
                $(".doctor-card").click(function() {
                    $(".doctor-card").removeClass("active");
                    $(this).addClass("active");

                    const doctorId = $(this).data("doctor-id");
                    selectedDoctor = selectedSpecialty.doctors.find(d => d.id === doctorId);

                    // Avanzar automáticamente
                    setTimeout(() => {
                        nextStep();
                    }, 800);
                });
            }

            function setupDatePicker() {
                $("#datepicker").datepicker({
                    dateFormat: "dd/mm/yy",
                    minDate: 0,
                    beforeShowDay: function(date) {
                        const day = date.getDay();
                        if (day === 0 || day === 6) {
                            return [false, "", "Fin de semana"];
                        }
                        return [true, "available", "Disponible"];
                    },
                    onSelect: function(dateText) {
                        selectedDate = dateText;
                        updateTimeSlots();
                        checkScheduleCompletion();
                    }
                });
            }

            function updateTimeSlots() {
                const $slots = $("#time-slots");
                $slots.empty();

                const timeSlots = ["08:00", "09:00", "10:00", "11:00", "12:00", 
                                 "14:00", "15:00", "16:00", "17:00", "18:00"];

                timeSlots.forEach(time => {
                    $slots.append(`
                        <div class="time-slot" data-time="${time}">
                            ${time}
                        </div>
                    `);
                });

                $(".time-slot").click(function() {
                    $(".time-slot").removeClass("selected");
                    $(this).addClass("selected");
                    selectedTime = $(this).data("time");
                    
                    checkScheduleCompletion();
                    
                    // Auto-avanzar si tiene fecha y hora
                    if (selectedDate && selectedTime) {
                        setTimeout(() => {
                            nextStep();
                        }, 500);
                    }
                });
            }

            function setupEventListeners() {
                // Tipo de consulta
                $(".consultation-option").click(function() {
                    $(".consultation-option").removeClass("active");
                    $(this).addClass("active");
                    consultationType = $(this).data("type");
                });

                // Método de pago
                $(".payment-method").click(function() {
                    $(".payment-method").removeClass("active");
                    $(this).addClass("active");
                    paymentMethod = $(this).data("method");
                    updatePaymentForm();
                });

                // Botón de pago
                $("#btn-pay").click(function() {
                    processPayment();
                });

                // Navegación móvil
                $("#mobile-back").click(function() {
                    previousStep();
                });

                $("#mobile-next").click(function() {
                    nextStep();
                });
            }

            function nextStep() {
                if (currentStep < 4) {
                    // Ocultar paso actual
                    $(`#step-${getStepName(currentStep)}`).removeClass("active").addClass("hidden");
                    
                    currentStep++;
                    
                    // Mostrar siguiente paso
                    setTimeout(() => {
                        $(`#step-${getStepName(currentStep)}`).removeClass("hidden").addClass("active");
                        
                        // Cargar contenido según el paso
                        switch(currentStep) {
                            case 2:
                                loadDoctors();
                                break;
                            case 4:
                                loadPaymentSummary();
                                break;
                        }
                        
                        updateProgress();
                        updateMobileNav();
                        
                        // Scroll suave al top
                        $('html, body').animate({
                            scrollTop: $('.progress-indicator').offset().top
                        }, 500);
                    }, 300);
                }
            }

            function previousStep() {
                if (currentStep > 1) {
                    $(`#step-${getStepName(currentStep)}`).removeClass("active").addClass("hidden");
                    currentStep--;
                    
                    setTimeout(() => {
                        $(`#step-${getStepName(currentStep)}`).removeClass("hidden").addClass("active");
                        updateProgress();
                        updateMobileNav();
                    }, 300);
                }
            }

            function getStepName(step) {
                const steps = ['', 'specialty', 'doctor', 'schedule', 'payment'];
                return steps[step];
            }

            function updateProgress() {
                // Actualizar círculos de progreso
                for (let i = 1; i <= 4; i++) {
                    const $step = $(`#progress-${i}`);
                    $step.removeClass("active completed");
                    
                    if (i < currentStep) {
                        $step.addClass("completed");
                        $step.find(".progress-step-circle").html('<i class="fas fa-check"></i>');
                    } else if (i === currentStep) {
                        $step.addClass("active");
                        $step.find(".progress-step-circle").text(i);
                    } else {
                        $step.find(".progress-step-circle").text(i);
                    }
                }

                // Actualizar línea de progreso
                const progressWidth = ((currentStep - 1) / 3) * 100;
                $("#progress-line").css("width", `${progressWidth}%`);
            }

            function updateMobileNav() {
                const $backBtn = $("#mobile-back");
                const $nextBtn = $("#mobile-next");

                if (currentStep > 1) {
                    $backBtn.show();
                } else {
                    $backBtn.hide();
                }

                if (currentStep === 4) {
                    $nextBtn.hide();
                } else {
                    $nextBtn.show();
                    $nextBtn.prop("disabled", !canProceed());
                }
            }

            function canProceed() {
                switch(currentStep) {
                    case 1:
                        return selectedSpecialty !== null;
                    case 2:
                        return selectedDoctor !== null;
                    case 3:
                        return selectedDate !== null && selectedTime !== null;
                    case 4:
                        return true;
                    default:
                        return false;
                }
            }

            function checkScheduleCompletion() {
                // Esta función se mantiene para compatibilidad pero la navegación es automática
                updateMobileNav();
            }

            function loadPaymentSummary() {
                const basePrice = selectedDoctor?.price || 50;
                const urgentFee = consultationType === 'urgent' ? 20 : 0;
                const totalPrice = basePrice + urgentFee;
                const payNow = Math.ceil(totalPrice / 2);

                $("#payment-amount").text(`${payNow}`);

                // Actualizar monto en Yape (convertir USD a PEN aproximadamente)
                const yapeAmount = (payNow * 3.75).toFixed(2);
                $("#yape-amount").text(`S/. ${yapeAmount}`);

                const summary = `
                    <div style="background: var(--color-gray-50); padding: var(--spacing-lg); border-radius: var(--border-radius-lg); margin-bottom: var(--spacing-lg);">
                        <h3 style="margin-bottom: var(--spacing-md); color: var(--color-primary);">
                            <i class="fas fa-clipboard-list"></i> Resumen de tu cita
                        </h3>
                        <div style="display: grid; gap: var(--spacing-sm);">
                            <div style="display: flex; justify-content: space-between;">
                                <span><strong>Especialidad:</strong></span>
                                <span>${selectedSpecialty?.name}</span>
                            </div>
                            <div style="display: flex; justify-content: space-between;">
                                <span><strong>Médico:</strong></span>
                                <span>${selectedDoctor?.name}</span>
                            </div>
                            <div style="display: flex; justify-content: space-between;">
                                <span><strong>Fecha:</strong></span>
                                <span>${selectedDate}</span>
                            </div>
                            <div style="display: flex; justify-content: space-between;">
                                <span><strong>Hora:</strong></span>
                                <span>${selectedTime}</span>
                            </div>
                            <div style="display: flex; justify-content: space-between;">
                                <span><strong>Tipo:</strong></span>
                                <span>${consultationType === 'urgent' ? 'Urgente' : 'Normal'}</span>
                            </div>
                            <hr style="margin: var(--spacing-sm) 0;">
                            <div style="display: flex; justify-content: space-between; font-weight: bold; color: var(--color-primary);">
                                <span>Total:</span>
                                <span>${totalPrice}</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; font-size: 0.9rem; color: var(--text-secondary);">
                                <span>Pagas ahora (50%):</span>
                                <span>${payNow}</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; font-size: 0.9rem; color: var(--text-secondary);">
                                <span>Pagas en consulta:</span>
                                <span>${totalPrice - payNow}</span>
                            </div>
                        </div>
                    </div>
                `;

                $("#appointment-summary").html(summary);
            }

            function updatePaymentForm() {
                $(".payment-form").removeClass("active");
                $(`#${paymentMethod}-form`).addClass("active");
                
                // Actualizar botón de pago según el método
                const $payBtn = $("#btn-pay");
                const $payBtnText = $("#pay-button-text");
                
                $payBtn.removeClass("btn-success btn-yape");
                
                switch(paymentMethod) {
                    case 'yape':
                        $payBtn.addClass("btn-yape");
                        $payBtnText.html('<i class="fas fa-mobile-alt"></i> Confirmar Pago con Yape');
                        startYapeCountdown();
                        break;
                    case 'card':
                        $payBtn.addClass("btn-success");
                        $payBtnText.html('<i class="fas fa-credit-card"></i> Pagar con Tarjeta');
                        stopYapeCountdown();
                        break;
                    case 'paypal':
                        $payBtn.addClass("btn-success");
                        $payBtnText.html('<i class="fab fa-paypal"></i> Pagar con PayPal');
                        stopYapeCountdown();
                        break;
                    case 'transfer':
                        $payBtn.addClass("btn-success");
                        $payBtnText.html('<i class="fas fa-university"></i> Pagar con Transferencia');
                        stopYapeCountdown();
                        break;
                }
            }

            function startYapeCountdown() {
                let timeLeft = 15 * 60; // 15 minutos en segundos
                
                function updateCountdown() {
                    const minutes = Math.floor(timeLeft / 60);
                    const seconds = timeLeft % 60;
                    const timeString = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                    $("#yape-countdown").text(timeString);
                    
                    if (timeLeft <= 0) {
                        clearInterval(yapeCountdown);
                        $("#yape-countdown").text("00:00");
                        $("#yape-countdown").parent().css("background", "var(--color-error)");
                        $("#yape-countdown").parent().html('<i class="fas fa-exclamation-triangle"></i> Tiempo expirado');
                    } else {
                        timeLeft--;
                    }
                }
                
                updateCountdown();
                yapeCountdown = setInterval(updateCountdown, 1000);
            }

            function stopYapeCountdown() {
                if (yapeCountdown) {
                    clearInterval(yapeCountdown);
                    yapeCountdown = null;
                }
            }

            function processPayment() {
                const $btn = $("#btn-pay");
                const originalText = $btn.html();
                
                // Diferentes mensajes según el método de pago
                let loadingMessage = "Procesando pago...";
                let processingTime = 3000;
                
                switch(paymentMethod) {
                    case 'yape':
                        loadingMessage = '<div class="loading"></div> Esperando confirmación de Yape...';
                        processingTime = 4000; // Simular tiempo de confirmación de Yape
                        break;
                    case 'card':
                        loadingMessage = '<div class="loading"></div> Procesando tarjeta...';
                        break;
                    case 'paypal':
                        loadingMessage = '<div class="loading"></div> Redirigiendo a PayPal...';
                        break;
                    case 'transfer':
                        loadingMessage = '<div class="loading"></div> Procesando transferencia...';
                        processingTime = 5000; // Transferencia toma más tiempo
                        break;
                }
                
                // Mostrar loading
                $btn.html(loadingMessage);
                $btn.prop("disabled", true);

                // Simular procesamiento
                setTimeout(() => {
                    $btn.html(originalText);
                    $btn.prop("disabled", false);
                    stopYapeCountdown(); // Detener countdown si está activo
                    showConfirmationModal();
                }, processingTime);
            }

            function showConfirmationModal() {
                // Mensaje personalizado según método de pago
                let paymentMethodText = "";
                switch(paymentMethod) {
                    case 'yape':
                        paymentMethodText = "💜 <strong>Pago con Yape confirmado</strong>";
                        break;
                    case 'card':
                        paymentMethodText = "💳 <strong>Pago con tarjeta procesado</strong>";
                        break;
                    case 'paypal':
                        paymentMethodText = "🅿️ <strong>Pago con PayPal completado</strong>";
                        break;
                    case 'transfer':
                        paymentMethodText = "🏦 <strong>Transferencia procesada</strong>";
                        break;
                }

                const basePrice = selectedDoctor?.price || 50;
                const urgentFee = consultationType === 'urgent' ? 20 : 0;
                const totalPrice = basePrice + urgentFee;
                const payNow = Math.ceil(totalPrice / 2);

                const message = `
                    <div style="text-align: left; padding: var(--spacing-md);">
                        <h4 style="color: var(--color-primary); margin-bottom: var(--spacing-md);">
                            🎉 Tu cita ha sido confirmada exitosamente
                        </h4>
                        <div style="background: var(--color-gray-50); padding: var(--spacing-md); border-radius: var(--border-radius); margin-bottom: var(--spacing-md);">
                            <p><strong>📋 Detalles de la cita:</strong></p>
                            <p>• <strong>Especialidad:</strong> ${selectedSpecialty?.name}</p>
                            <p>• <strong>Médico:</strong> ${selectedDoctor?.name}</p>
                            <p>• <strong>Fecha:</strong> ${selectedDate}</p>
                            <p>• <strong>Hora:</strong> ${selectedTime}</p>
                            <p>• <strong>Consultorio:</strong> #${Math.floor(Math.random() * 20) + 1}</p>
                        </div>
                        <div style="background: var(--color-success); color: white; padding: var(--spacing-md); border-radius: var(--border-radius); text-align: center;">
                            <p>${paymentMethodText}</p>
                            <p>Se ha procesado tu pago del 50% (${payNow})</p>
                        </div>
                        <p style="margin-top: var(--spacing-md); font-size: 0.9rem; color: var(--text-secondary);">
                            📧 Recibirás un correo con todos los detalles y el código QR para tu cita.
                            <br>📱 También puedes descargar nuestra app para recibir recordatorios.
                        </p>
                    </div>
                `;

                $("#confirmation-message").html(message);
                $("#confirmation-modal").addClass("active");
            }

            function getRatingStars(rating) {
                const fullStars = Math.floor(rating);
                const hasHalfStar = rating % 1 >= 0.5;
                let stars = '';

                for (let i = 0; i < fullStars; i++) {
                    stars += '<i class="fas fa-star"></i>';
                }

                if (hasHalfStar) {
                    stars += '<i class="fas fa-star-half-alt"></i>';
                }

                const emptyStars = 5 - Math.ceil(rating);
                for (let i = 0; i < emptyStars; i++) {
                    stars += '<i class="far fa-star"></i>';
                }

                return stars;
            }

            // Función global para cerrar modal
            window.closeModal = function() {
                $("#confirmation-modal").removeClass("active");
            }

            // Función global para resetear flujo
            window.resetFlow = function() {
                // Resetear variables
                currentStep = 1;
                selectedSpecialty = null;
                selectedDoctor = null;
                selectedDate = null;
                selectedTime = null;
                consultationType = 'normal';
                paymentMethod = 'card';

                // Detener countdown de Yape si está activo
                stopYapeCountdown();

                // Resetear UI
                $(".specialty-card, .doctor-card, .consultation-option, .payment-method").removeClass("active");
                $(".consultation-option[data-type='normal']").addClass("active");
                $(".payment-method[data-method='card']").addClass("active");
                $("#datepicker").val("");
                $("#time-slots").empty();

                // Mostrar solo primer paso
                $(".step-container").removeClass("active").addClass("hidden");
                $("#step-specialty").removeClass("hidden").addClass("active");

                updateProgress();
                updateMobileNav();
                closeModal();

                // Scroll to top
                $('html, body').animate({ scrollTop: 0 }, 500);
            }

            // Formatear números de tarjeta
            $(document).on('input', 'input[placeholder*="1234"]', function() {
                let value = $(this).val().replace(/\s/g, '').replace(/[^0-9]/gi, '');
                let formattedValue = value.match(/.{1,4}/g)?.join(' ') || value;
                $(this).val(formattedValue);
            });

            // Formatear fecha de vencimiento
            $(document).on('input', 'input[placeholder="MM/AA"]', function() {
                let value = $(this).val().replace(/\D/g, '');
                if (value.length >= 2) {
                    value = value.substring(0,2) + '/' + value.substring(2,4);
                }
                $(this).val(value);
            });

            // Limpiar intervalos al cerrar la página
            $(window).on('beforeunload', function() {
                stopYapeCountdown();
            });
        });
    </script>
</body>

</html>